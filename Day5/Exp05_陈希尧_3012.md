<center style = "font-size: 4em">金融科技导论实验报告</center><br/><br/><br/><br/>

**姓名**：<u>陈希尧</u>

**学号**：<u>3180103012</u>

**专业**：<u>计算机科学与技术</u>

**课程名称**：<u>金融科技导论</u>

<center style = "font-size: 1.7em">Table of Contents</center>

[TOC]

## 实验目的

学习投资组合基本流程，了解投资组合算法框架，并实现经典投资组合策略。

## 模型实现

### MV

### EG

首先需要注意的是由于此模型和下面的ONS模型都是基于资本增长理论的，所以在计算权值时除了市场和投资产品本身的数据，还需要旧的权重信息，因此要稍微修改一下"\_\_init\_\_.py"中的接口：

```python
def runPortfolio(stocks, portfolio, method, dataset):
    
    ...

    wk = np.array([1/n for i in range(n)], dtype=np.float64)

    for k in range(dataset["span_t"] - 1 + dataset["init_t"], m, 1):
        
        ...

        if method["function"] == "EG" or method["function"] == "ONS":
            wk = weight_compute(n, context, wk)
        else:
            wk = weight_compute(n, context)

        ...
```

仔细阅读论文之后根据公式$\displaystyle w_i^{t+1} = \frac{w_i^t \exp(\eta x_i^t/\vec w^t \cdot \vec x^t)}{\sum_{j=1}^N w_j^t \exp(\eta x_j^t/\vec w^t \cdot \vec x^t)}$实现模型，基本实现如下：

```python
def EG_weight_compute(n, context, w_pre=None, learning_rate=0.5):
    diff = np.array(context["Rk"] - 1)
    grad_k = - diff / np.dot(w_pre, diff)
    
    w_k = w_pre * np.exp(-learning_rate * grad_k)
    w_k = w_k / np.sum(w_k)
    return w_k
```

但是这样子在运行的时候会遇上`RuntimeWarning: overflow encountered in exp: w_k = w_pre * np.exp(-learning_rate * grad_k)`和`RuntimeWarning: invalid value encountered in true_divide: grad_k = - diff / np.dot(w_pre, diff)`的warning，然后结果中EG这一项全部是NaN。经过调试，我发现这是因为在Exponential Gradient的过程中，只有某一项会接近1（0.999...这样子），而其他都是非常小的数，基本上是在$10^{-30}$之下的，有些甚至小到float64无法表示。我一开始以为是数据的问题（弄错了R和P）导致了这种极端的情况的出现，后来经过再次反复比对发现那个接近1的股票正是收益最好的那一只（即Best策略的选股），因此只要在这种情况加上一个Best的修正就可以了，补充如下：

```python
if np.isnan(w_k).any():
    w_k = np.zeros(n)
    w_k[np.argmax(context["Rk"])] = 1
```

### ONS

## 实验结果

### 参数η对增量模型的影响

| η | 0.0 | 0.2 | 0.4 | 0.6 | 0.8 | 1.0 |
| --- | --- | --- | --- | --- | --- | --- |
| cumulative_wealth | 22.2183 | 1.56173e+12 | 1.63991e+12 | 1.68419e+12 | 1.70613e+12 | 1.71615e+12 |
| sharpe_ratio | 0.0666088 | 0.152055 | 0.152211 | 0.152324 | 0.15238 | 0.152405 |
| volatility | 0.00844834 | 0.033585 | 0.033609 | 0.0336159 | 0.0336192 | 0.0336206 |
| max_drawdown | 0.365959 | 0.423554 | 0.423554 | 0.423554 | 0.423554 | 0.423554 |

## Bonus：模型的数学推导

### EG

$$
{
    \because ok
    \\
    \therefore afiwfwaf
}
$$

### ONS

## 附录

